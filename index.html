<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mt. Tom Turkey AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- A-Frame library -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <!-- AR.js library (includes location-based AR) -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <!-- Look-at component for facing the viewer -->
    <script src="https://unpkg.com/aframe-look-at-component@1.0.0/dist/aframe-look-at-component.min.js"></script>
</head>
<body>
    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: true;"
        renderer="logarithmicDepthBuffer: true;"
        loading-screen="dotsColor: white; backgroundColor: blue;">
        
        <!-- Preload assets with timeout for better loading handling -->
        <a-assets timeout="10000">
            <a-asset-item id="turkey-model" src="./turkey.glb"></a-asset-item>
            <audio id="music-audio" src="./music.mp3"></audio>
        </a-assets>
        
        <!-- Camera with GPS tracking -->
        <a-camera gps-new-camera="gpsMinDistance: 5;" rotation-reader></a-camera>
        
        <!-- Geo-anchored turkey entity -->
        <a-entity
            id="turkey"
            gps-new-entity-place="latitude: 42.24158; longitude: -72.64839;"
            scale="500 500 500"
            position="0 200 0"
            look-at="[gps-new-camera]">
            <a-gltf-model src="#turkey-model"></a-gltf-model>
        </a-entity>
        
        <!-- Audio -->
        <a-sound src="#music-audio" autoplay="true" loop="true" volume="1"></a-sound>
        
        <!-- Debug text entity for on-screen messages -->
        <a-text
            value="Loading AR scene... Check console for errors."
            position="0 0 -1"
            scale="0.5 0.5 0.5"
            color="white"></a-text>
    </a-scene>

    <!-- Script with additional logging -->
    <script>
        const scene = document.querySelector('a-scene');
        const debugText = document.querySelector('a-text');
        
        scene.addEventListener('loaded', function() {
            console.log('Scene loaded');
            if (debugText) debugText.setAttribute('value', 'Scene loaded - Waiting for GPS');
        });
        
        scene.addEventListener('gps-camera-update-position', function(evt) {
            console.log('GPS position updated', evt.detail);
            if (debugText) debugText.setAttribute('value', 'GPS updated - Check for turkey');
        });
        
        scene.addEventListener('gps-camera-error', function(evt) {
            console.error('GPS Camera Error:', evt.detail);
            if (debugText) debugText.setAttribute('value', 'GPS Error: ' + evt.detail.message);
        });
        
        // Log asset loads
        document.querySelector('#turkey-model').addEventListener('loaded', function() {
            console.log('GLB loaded');
        });
        document.querySelector('#turkey-model').addEventListener('error', function(evt) {
            console.error('GLB Load Error:', evt.detail);
            if (debugText) debugText.setAttribute('value', 'GLB Error: ' + evt.detail.message);
        });
        
        document.querySelector('#music-audio').addEventListener('loadeddata', function() {
            console.log('Audio loaded');
        });
        document.querySelector('#music-audio').addEventListener('error', function(evt) {
            console.error('Audio Load Error:', evt.detail);
            if (debugText) debugText.setAttribute('value', 'Audio Error: ' + evt.detail.message);
        });
        
        // Timeout to detect stuck loading
        setTimeout(function() {
            if (scene.hasLoaded) {
                console.log('Scene fully loaded after timeout');
            } else {
                console.error('Scene stuck loading after 10s');
                if (debugText) debugText.setAttribute('value', 'Loading stuck - Check console');
            }
        }, 10000);
    </script>
</body>
</html>
