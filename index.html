<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mt. Tom Turkey AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- A-Frame library -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <!-- AR.js library (includes location-based AR) -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <!-- Look-at component for facing the viewer -->
    <script src="https://unpkg.com/aframe-look-at-component@1.0.0/dist/aframe-look-at-component.min.js"></script>
</head>
<body>
    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: true;"
        renderer="logarithmicDepthBuffer: true;"
        loading-screen="dotsColor: white; backgroundColor: blue;">
        
        <!-- Preload assets with timeout to prevent stuck loading -->
        <a-assets timeout="10000">
            <a-asset-item id="turkey-model" src="./turkey.glb"></a-asset-item>
            <audio id="music-audio" src="./music.mp3"></audio>
        </a-assets>
        
        <!-- Camera with GPS tracking -->
        <a-camera gps-new-camera="gpsMinDistance: 5;" rotation-reader></a-camera>
        
        <!-- Geo-anchored turkey entity (stationary by default, faces viewer) -->
        <a-entity
            id="turkey"
            gps-new-entity-place="latitude: 42.24158; longitude: -72.64839;"
            scale="500 500 500" <!-- Initial fallback scale -->
            position="0 200 0" <!-- Hover height in meters -->
            look-at="[gps-new-camera]"> <!-- Faces the viewer -->
            <a-gltf-model src="#turkey-model"></a-gltf-model> <!-- Use preloaded asset -->
        </a-entity>
        
        <!-- Audio using preloaded asset -->
        <a-sound src="#music-audio" autoplay="true" loop="true" volume="1"></a-sound>
    </a-scene>

    <!-- Script for dynamic scaling based on distance -->
    <script>
        const scene = document.querySelector('a-scene');
        scene.addEventListener('loaded', function() {
            scene.addEventListener('gps-camera-update-position', function(evt) {
                const entity = document.querySelector('#turkey');
                const gpsComponent = entity.components['gps-new-entity-place'];
                
                if (gpsComponent && gpsComponent.distance) {
                    const distance = gpsComponent.distance; // In meters
                    const scaleFactor = distance / 1000; // Tune: smaller divisor = larger size
                    entity.setAttribute('scale', `${scaleFactor} ${scaleFactor} ${scaleFactor}`);
                }
            });
            
            // Log errors for debugging
            scene.addEventListener('gps-camera-error', function(evt) {
                console.error('GPS Camera Error:', evt.detail);
            });
            
            // Log asset load errors
            document.querySelector('#turkey-model').addEventListener('error', function(evt) {
                console.error('GLB Load Error:', evt.detail);
            });
            document.querySelector('#music-audio').addEventListener('error', function(evt) {
                console.error('Audio Load Error:', evt.detail);
            });
        });
    </script>
</body>
</html>
